<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TEMPLETE</title>

<style>
/* ===================== Purple Pastel Unified UI ===================== */
:root{
  --page-bg:#f7f4ff;
  --page-bg2:#eef6ff;
  --card-bg:rgba(255,255,255,.9);
  --card-stroke:rgba(170,150,230,.22);
  --text:#2f2a3a;
  --sub:#6e6a82;
  --muted:rgba(110,106,130,.6);
  --pink:#ff8fbc;
  --lilac:#b8a7ff;
  --shadow-main:0 18px 50px rgba(30,18,60,.1);
  --shadow-card:0 10px 26px rgba(30,18,60,.08);
  --radius-xl:24px;
}
*{box-sizing:border-box}
body{
  margin:0;padding:24px;
  font-family:Pretendard,system-ui;
  background:linear-gradient(180deg,var(--page-bg),var(--page-bg2));
  display:flex;justify-content:center;
}
.app{
  width:100%;max-width:1280px;
  background:var(--card-bg);
  border:1px solid var(--card-stroke);
  border-radius:var(--radius-xl);
  box-shadow:var(--shadow-main);
  padding:18px;
  height:calc(100vh - 48px);
  display:flex;flex-direction:column;
}
.app-header{margin-bottom:10px}
.app-title{font-size:20px;font-weight:800}

.app-body{display:flex;gap:14px;flex:1;min-height:0}
.left-panel{flex:1;display:flex;flex-direction:column;gap:10px}

.search-input{
  width:100%;height:42px;
  padding:0 16px;
  border-radius:999px;
  border:1px solid rgba(170,150,230,.22);
  font-size:13px;
}

.list-panel{
  flex:1;
  background:#fff;
  border-radius:18px;
  border:1px solid rgba(170,150,230,.18);
  padding:12px;
  overflow:auto;
}

.macro-item{
  padding:10px;
  border-bottom:1px dashed rgba(170,150,230,.25);
  cursor:pointer;
}
.macro-item:hover{background:rgba(255,143,188,.1)}

.editor-panel{
  flex:1;
  background:#fff;
  border-radius:18px;
  border:1px solid rgba(170,150,230,.18);
  padding:12px;
  display:flex;flex-direction:column;gap:8px;
}

.tone-pill{
  padding:4px 10px;
  border-radius:999px;
  border:1px solid rgba(170,150,230,.22);
  background:#fff;
  cursor:pointer;
  font-size:12px;
}
.tone-pill.active{
  background:rgba(255,143,188,.18);
  border-color:rgba(255,143,188,.35);
}

.editor-textarea{
  flex:1;
  resize:none;
  border-radius:14px;
  border:1px solid rgba(170,150,230,.22);
  padding:12px;
  font-size:13px;
}

.answer-btn{
  height:36px;
  border-radius:999px;
  border:1px solid rgba(170,150,230,.22);
  background:#fff;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="app">

  <div class="app-header">
    <div class="app-title">TEMPLETE</div>
  </div>

  <div class="app-body">

    <!-- LEFT -->
    <div class="left-panel">
      <input id="searchInput" class="search-input" placeholder="검색어 입력" />
      <div id="results" class="list-panel"></div>
    </div>

    <!-- RIGHT -->
    <div class="editor-panel">

      <!-- MODE -->
      <div style="display:flex;gap:6px">
        <button class="tone-pill active" id="modeChatBtn">(채팅)답변</button>
        <button class="tone-pill" id="modeReviewBtn">(상품)리뷰</button>
      </div>

      <!-- TONE -->
      <div style="display:flex;gap:6px">
        <button class="tone-pill active" data-tone="발랄">발랄</button>
        <button class="tone-pill" data-tone="차분">차분</button>
      </div>

      <textarea id="questionTextarea" class="editor-textarea" placeholder="고객 문의 또는 리뷰 원문을 붙여넣어 주세요"></textarea>

      <button id="answerBtn" class="answer-btn">답변 생성</button>

      <textarea id="editorTextarea" class="editor-textarea" placeholder="생성된 답변"></textarea>
    </div>

  </div>
</div>

<script>
/* ================= API KEY 90일 저장 ================= */
const KEY_NAME="WHITESANDS_OPENAI_KEY_V1";
const TTL=90*24*60*60*1000;

function saveKey(key){
  localStorage.setItem(KEY_NAME,JSON.stringify({key,saved:Date.now()}));
}
function loadKey(){
  try{
    const v=JSON.parse(localStorage.getItem(KEY_NAME));
    if(!v) return "";
    if(Date.now()-v.saved>TTL){
      localStorage.removeItem(KEY_NAME);
      return "";
    }
    return v.key;
  }catch{return ""}
}
let OPENAI_API_KEY=loadKey();

function ensureKey(){
  if(OPENAI_API_KEY) return true;
  const k=prompt("OpenAI API 키 입력 (90일 저장)");
  if(!k) return false;
  OPENAI_API_KEY=k.trim();
  saveKey(OPENAI_API_KEY);
  return true;
}

/* ================= MODE ================= */
let MODE="chat";
const chatBtn=document.getElementById("modeChatBtn");
const reviewBtn=document.getElementById("modeReviewBtn");
chatBtn.onclick=()=>{MODE="chat";chatBtn.classList.add("active");reviewBtn.classList.remove("active");};
reviewBtn.onclick=()=>{MODE="review";reviewBtn.classList.add("active");chatBtn.classList.remove("active");};

/* ================= TONE ================= */
let TONE="발랄";
document.querySelectorAll("[data-tone]").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("[data-tone]").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    TONE=b.dataset.tone;
  };
});

/* ================= PROMPTS ================= */
function systemPrompt(){
  if(MODE==="review"){
return `
너는 화이트샌즈 상품 리뷰 답변 상담사다.
공감 → 해결 방향 → 채널 안내 순서로 3~6문장.
책임 단정/보상 확정 금지.
톤:${TONE}
`;
  }
return `
너는 화이트샌즈 고객센터 상담사다.
공감 → 결론 → 이유 → 다음 행동 → 마무리.
감정 케어 우선, 책임 인정 표현 금지.
톤:${TONE}
`;
}

/* ================= ANSWER ================= */
document.getElementById("answerBtn").onclick=async()=>{
  if(!ensureKey()) return;
  const q=document.getElementById("questionTextarea").value.trim();
  if(!q) return alert("내용을 입력하세요");

  const res=await fetch("https://api.openai.com/v1/chat/completions",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+OPENAI_API_KEY
    },
    body:JSON.stringify({
      model:"gpt-4.1-mini",
      messages:[
        {role:"system",content:systemPrompt()},
        {role:"user",content:q}
      ]
    })
  });

  const data=await res.json();
  document.getElementById("editorTextarea").value=
    data.choices?.[0]?.message?.content || "";
};
</script>
</body>
</html>
